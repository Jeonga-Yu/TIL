# 코드가 푸시되면 자동으로 배포해보자 - Travis CI 배포 자동화

24시간 365일 운영되는 서비스에서 배포 환경 구축은 필수!

## 9.1 CI & CD 소개

스크립트를 개발자가 직접 실행 함으로써 발생하는 불편을 CI, CD 환경을 구축하여 과정을 개선한다.

### CI와 CD란

코드 버전관리를 하는 VCS 시스템에 PUSH가 되면 자동으로 테스트와 빌드가 수행되어 안정적인 배포 파일을 만드는 과정을 CI(Continuous Integration - 지속적 통합)라고 하며, 빌드 결과를 자동으로 운영 서버에 무중단 배포까지 진행되는 과정을 CD(Continuous Deployment - 지속적인 배포)라고 한다.

### 마틴 파울러의  CI 4가지 규칙

- 모든 소스코드가 살아있고(현재 실행되고) 누구든 현재의 소스에 접근할 수 있는 단일 지점을 유지할 것
- 빌드 프로세스를 자동화해서 누구든 소스로부터 시스템을 빌드하는 단일 명령어를 사용할 수 있게 할 것
- 테스팅을 자동화해서 단일 명령어로 언제든지 시스템에 대한 건전한 테스트 수트를 실행할 수 있게 할 것
- 누구나 현재 실행 파일을 얻으면 지금까지 가장 완전한 실행 파일을 얻었다는 확신을 하게 할 것

## 9.2 Travis CI 연동하기

Travis CI는 깃허브에서 제공하는 무료 CI서비스이다.

상세한 설정은 프로젝트의 yml파일로 진행한다

### 프로젝트 설정

Travis CI의 상세한 설정은 프로젝트에 존재하는 .travis.yml 파일로 할 수 있다. YAML 은 쉽게 말해서 JSON에서 괄호를 제거한 것이다. (AWS의 Code Deploy설정도 YAML 파일을 통해서 한다.)

## 9.3 Travis CI와 AWS S3 연동하기

### AWS S3

S3란 AWS에서 제공하는 일종의 파일 서버이다. 이미지 파일을 비롯한 정적 파일들을 관리하거나 지금 진행하는 것처럼 배포 파일들을 관리하는 등의 기능을 지원한다. 

AWS CodDeploy는 저장 기능이 없기 때문에 Travis CI 가 빌드한 결과물을 받아서 CodeDeploy가 가져갈 수 있도록 보관할 수 있는 공간이 필요한데 보통 이럴 때 AWS S3를 이용한다. 

보통 게시글을 쓸 때 나오는 첨부파일 등록을 구현할 때 많이 이용한다. 파일 서버의 역할을 하기 때문인데, 여기서는 Travis CI에서 생성된 Build파일을 저장하도록 구성한다.

### IAM (Identity and Access Management)

일반적으로 AWS 서비스에 외부 서비스가 접근할 수 없다. 그러므로 접근 가능한 권한을 가진 key를 생성해서 사용해야 하는데 AWS는 이러한 인증과 관련된 기능을 제공하는 서비스로 IAM이 있다. IAM은 AWS에서 제공하는 서비스의 접근 방식과 권한을 관리한다. 

## 9.4 Travis CI와 AWS S3, CodeDeploy 연동하기

### AWS 배포 삼형제

- Code Commit

    깃허브와 같은 코드 저장소의 역할

    프라이빗 기능을 지원한다는 강점, 현재 깃허브에서 무료로 프라이빗 지원을 하고있어 거의 사용되지 않는다.

- Code Builder

    Travis CI와 마찬가지로 빌드용 서비스이다

    멀티 모듈을 배포해야 하는 경우 사용해 볼만하지만, 규모가 있는 서비스에서는 대부분 젠킨스/팀시티 등을 이용해서 사용할 일이 거의 없다.

- CodeDeploy

    AWS의 배포 서비스

    CodeDeploy 대체제가 없다

    오토 스케일링 그룹 배포, 블루 그린 배포, 롤링 배포, EC2 단독 배포 등 많은 기능을 지원한다.
